# 业务监控项模板配置 - Gateway 网关服务
# 文件名：base_gateway_service_business_template.properties

# 模板基本信息
zabbix.template="base_gateway_service_business_template"
zabbix.template.name="base_gateway_service_business_template"
zabbix.template.version="5.0"

# 模板组信息
zabbix.groups[0].name="business_monitor"

# 应用信息
zabbix.applications[0].name="base_gateway_service"

# 模板依赖（关键：声明依赖主监控项模板）
zabbix.templates[0].name="master_prometheus_business_template"

# ========== 低级别发现规则：API 计数器 ==========
# 发现所有 API 调用统计（按 URL、状态、方法等维度）
zabbix.discovery[0].name="saas_gateway_api_counter_times"
zabbix.discovery[0].key="saas_gateway_api_counter_times.discovery"
zabbix.discovery[0].type="DEPENDENT"
zabbix.discovery[0].delay="0"
zabbix.discovery[0].lifetime="3d"
# 引用主监控项
zabbix.discovery[0].master_item="master.prometheus[{$EXPORTTOOL_URL}]"
# 预处理：将 Prometheus 格式转换为 JSON（用于 LLD）
zabbix.discovery[0].preprocessing_type="PROMETHEUS_TO_JSON"
zabbix.discovery[0].preprocessing_params="saas_gateway_api_counter_times{}"
# LLD 宏定义：定义要提取的标签
zabbix.discovery[0].lld_macros="APPID,METHOD,SOURCE,STATE,TENANTID,URL,METRIC_NAME"
# 应用分组
zabbix.discovery[0].appName="base_gateway_service"

# LLD 监控项原型：动态创建每个 API 的监控项
zabbix.discovery[0].item_prototype.name="API Counter: [{#URL}] [{#METHOD}] [{#STATE}] [appId:{#APPID}] [tenantId:{#TENANTID}]"
zabbix.discovery[0].item_prototype.key="saas_gateway_api_counter_times[{#URL},{#METHOD},{#STATE},{#SOURCE},{#APPID},{#TENANTID}]"

