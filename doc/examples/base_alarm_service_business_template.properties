# 业务监控项模板配置
# 文件名：{serviceName}_business_template.properties（serviceName自动从pom.xml读取）

# 模板基本信息
zabbix.template="base_alarm_service_business_template"
zabbix.template.name="base_alarm_service_business_template"
zabbix.template.version="5.0"

# 模板组信息
zabbix.groups[0].name="business_monitor"

# 应用信息
zabbix.applications[0].name="base_alarm_service"

# 模板依赖（关键：声明依赖主监控项模板）
zabbix.templates[0].name="master_prometheus_business_template"

# 业务监控项配置
# 更新管理员信息调度任务 - 监控更新管理员信息的定时任务执行情况
zabbix.items[0].name="ft_manager_app_update_admin_info_scheduler_task"
zabbix.items[0].key="ft_manager_app_update_admin_info_scheduler_task"
zabbix.items[0].type="DEPENDENT"
zabbix.items[0].value_type="FLOAT"
zabbix.items[0].delay="0"
# 关键：引用主监控项（来自master_prometheus_business_template.properties）
zabbix.items[0].master_item="master.prometheus[{$EXPORTTOOL_URL}]"
zabbix.items[0].preprocessing_type="PROMETHEUS_PATTERN"
zabbix.items[0].preprocessing_params="ft_manager_app_update_admin_info_scheduler_task{}"
zabbix.items[0].appName="base_alarm_service"

# 发现规则配置
# DCS业务信息发现规则 - 自动发现DCS(Distributed Control System)业务信息指标
# 用于监控不同应用、租户、类别的业务数据，支持动态发现和监控
zabbix.discovery_rules[0].name="s17_dcs_dcsBusinessInfo"
zabbix.discovery_rules[0].key="s17_dcs_dcsBusinessInfo.discovery"
zabbix.discovery_rules[0].type="DEPENDENT"
zabbix.discovery_rules[0].delay="0"
zabbix.discovery_rules[0].lifetime="3d"
# 同样引用主监控项
zabbix.discovery_rules[0].master_item="master.prometheus[{$EXPORTTOOL_URL}]"
zabbix.discovery_rules[0].preprocessing_type="PROMETHEUS_TO_JSON"
zabbix.discovery_rules[0].preprocessing_params="s17_dcs_dcsBusinessInfo{}"
zabbix.discovery_rules[0].lld_macros="APPID,CATEGORY,METRIC_NAME,SOURCE,TENANTID"
zabbix.discovery_rules[0].appName="base_alarm_service"
# item_prototype配置
zabbix.discovery_rules[0].item_prototype.name="s17_dcs_dcsBusinessInfo:[{#CATEGORY}] [appId:{#APPID}] [tenantId:{#TENANTID}]"
zabbix.discovery_rules[0].item_prototype.key="s17_dcs_dcsBusinessInfo[{#CATEGORY},{#APPID},{#TENANTID}]"

# DJMS当前任务信息发现规则 - 自动发现DJMS(Distributed Job Management System)当前任务信息
# 用于监控不同应用、租户、类别的任务执行情况，支持动态发现和监控
zabbix.discovery_rules[1].name="s17_djms_currentTaskInfo"
zabbix.discovery_rules[1].key="s17_djms_currentTaskInfo.discovery"
zabbix.discovery_rules[1].type="DEPENDENT"
zabbix.discovery_rules[1].delay="0"
zabbix.discovery_rules[1].lifetime="3d"
zabbix.discovery_rules[1].master_item="master.prometheus[{$EXPORTTOOL_URL}]"
zabbix.discovery_rules[1].preprocessing_type="PROMETHEUS_TO_JSON"
zabbix.discovery_rules[1].preprocessing_params="s17_djms_currentTaskInfo{}"
zabbix.discovery_rules[1].lld_macros="APPID,CATEGORY,METRIC_NAME,TENANTID"
zabbix.discovery_rules[1].appName="base_alarm_service"
zabbix.discovery_rules[1].item_prototype.name="s17_djms_currentTaskInfo:[{#CATEGORY}] [appId:{#APPID}] [tenantId:{#TENANTID}]"
zabbix.discovery_rules[1].item_prototype.key="s17_djms_currentTaskInfo[{#CATEGORY},{#APPID},{#TENANTID}]"

